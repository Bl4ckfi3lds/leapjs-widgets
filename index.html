<!DOCTYPE HTML>
<html>
  <head>
    <title>Beer Pong</title>
  </head>
  <body>
    <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="bower_components/sass-bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="javascripts/lib/three.js"></script>
    <script type="text/javascript" src="javascripts/lib/physi.js"></script>
    <script type="text/javascript" src="javascripts/lib/Detector.js"></script>
    <script type="text/javascript" src="javascripts/lib/TrackballControls.js"></script>
    <script type="text/javascript" src="javascripts/lib/leap-0.6.0-beta1-custom.js"></script>
    <script type="text/javascript" src="javascripts/lib/leap-plugins-0.1.4.1-custom.js"></script>
    <script type="text/javascript" src="javascripts/lib/leap.transform.js"></script>
    <script type="text/javascript" src="javascripts/lib/leap.rigged-hand-0.1.0-custom.js"></script>
    <script type="text/javascript" src="javascripts/cup_formation.js"></script>
    <script type="text/javascript" src="javascripts/scene.js"></script>
    <script type="text/javascript">
        (window.controller = new Leap.Controller)
          .use('transform', {
            position: function(hand){
              return new THREE.Vector3(0, 0, 200);
            }
          })
          .use('riggedHand', {
            parent: window.scene,
            positionScale: 2.5,
            scale: 1.5,
            boneColors: function(){
              return {
                hue: 0.1,
                saturation: 1,
                lightness: 0.88
              }
            }
          })
          .connect()
          .on('frame', function(frame){
            window.fingerBalls = window.fingerBalls || {};
            frame.hands.forEach(function(leapHand, i) {
                fingerBalls[i] = fingerBalls[i] || {};
                var handMesh = leapHand.data('riggedHand.mesh');
                leapHand.fingers.forEach(function(finger, j) {
                    fingerBalls[i][j] = fingerBalls[i][j] || {};
                    [finger.tipPosition, finger.dipPosition, finger.mcpPosition].forEach(function(tip,k) {
                      if (!fingerBalls[i][j][k]) {
                        fingerBalls[i][j][k] = fingerBalls[i][j][k] || new Physijs.SphereMesh(
                          new THREE.SphereGeometry(0.6, 32, 32),
                          Physijs.createMaterial(new THREE.MeshPhongMaterial({color: 0x0000ff}), 100, 0),
                          100
                        );
                        fingerBalls[i][j][k].visible = false;
                        fingerBalls[i][j][k].castShadow = false;
                        scene.add(fingerBalls[i][j][k]);
                      }
                      var clonepos = fingerBalls[i][j][k].position.clone();
                      handMesh.scenePosition([tip[0], tip[1], tip[2]], clonepos);
                      fingerBalls[i][j][k].setLinearVelocity(clonepos.sub(fingerBalls[i][j][k].position).multiplyScalar(15));
                    });
                });
            });
          });
    </script>
  </body>
</html>